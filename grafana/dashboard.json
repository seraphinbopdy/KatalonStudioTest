{
  "dashboard": {
    "id": null,
    "uid": "katalon-tests",
    "title": "Katalon Test Results - QA Dashboard",
    "timezone": "browser",
    "schemaVersion": 37,
    "version": 4,
    "refresh": "10s",
    "tags": ["CI", "Katalon", "QA", "Soutenance"],
    "panels": [
      {
        "type": "row",
        "title": "üìä Global Stats",
        "id": 100
      },
      {
        "type": "stat",
        "title": "Total Tests",
        "id": 1,
        "datasource": "PostgreSQL",
        "targets": [{ "rawSql": "SELECT COUNT(*) as total FROM test_results", "refId": "A" }]
      },
      {
        "type": "stat",
        "title": "‚úÖ Passed",
        "id": 2,
        "datasource": "PostgreSQL",
        "targets": [{ "rawSql": "SELECT COUNT(*) as passed FROM test_results WHERE test_status = 'PASSED'", "refId": "A" }]
      },
      {
        "type": "stat",
        "title": "‚ùå Failed",
        "id": 3,
        "datasource": "PostgreSQL",
        "targets": [{ "rawSql": "SELECT COUNT(*) as failed FROM test_results WHERE test_status = 'FAILED'", "refId": "A" }]
      },
      {
        "type": "stat",
        "title": "‚è≠ Skipped",
        "id": 4,
        "datasource": "PostgreSQL",
        "targets": [{ "rawSql": "SELECT COUNT(*) as skipped FROM test_results WHERE test_status = 'SKIPPED'", "refId": "A" }]
      },
      {
        "type": "gauge",
        "title": "Success Rate (%)",
        "id": 5,
        "datasource": "PostgreSQL",
        "targets": [
          {
            "rawSql": "SELECT ROUND(100.0 * SUM(CASE WHEN test_status = 'PASSED' THEN 1 ELSE 0 END)/COUNT(*),2) as success_rate FROM test_results",
            "refId": "A"
          }
        ]
      },
      {
        "type": "gauge",
        "title": "Avg Test Duration (sec)",
        "id": 6,
        "datasource": "PostgreSQL",
        "targets": [{ "rawSql": "SELECT ROUND(AVG(test_duration),2) as avg_duration FROM test_results", "refId": "A" }]
      },

      {
        "type": "row",
        "title": "üß™ Stats par Suite",
        "id": 200
      },
      {
        "type": "table",
        "title": "Tests per Suite",
        "id": 7,
        "datasource": "PostgreSQL",
        "targets": [
          {
            "rawSql": "SELECT test_suite_name, COUNT(*) as total, SUM(CASE WHEN test_status='PASSED' THEN 1 ELSE 0 END) as passed, SUM(CASE WHEN test_status='FAILED' THEN 1 ELSE 0 END) as failed, ROUND(AVG(test_duration),2) as avg_duration FROM test_results GROUP BY test_suite_name ORDER BY total DESC",
            "refId": "A"
          }
        ]
      },

      {
        "type": "row",
        "title": "üß© Stats par Type de Test",
        "id": 300
      },
      {
        "type": "piechart",
        "title": "R√©partition par Type (UI/API/Mobile)",
        "id": 8,
        "datasource": "PostgreSQL",
        "targets": [
          { "rawSql": "SELECT test_type, COUNT(*) as total FROM test_results GROUP BY test_type", "refId": "A" }
        ]
      },

      {
        "type": "row",
        "title": "‚öôÔ∏è Stats par Feature",
        "id": 400
      },
      {
        "type": "table",
        "title": "Tests par Feature",
        "id": 9,
        "datasource": "PostgreSQL",
        "targets": [
          { "rawSql": "SELECT feature, COUNT(*) as total, SUM(CASE WHEN test_status='PASSED' THEN 1 ELSE 0 END) as passed, SUM(CASE WHEN test_status='FAILED' THEN 1 ELSE 0 END) as failed FROM test_results GROUP BY feature ORDER BY total DESC", "refId": "A" }
        ]
      },

      {
        "type": "row",
        "title": "üåê Stats par Navigateur",
        "id": 500
      },
      {
        "type": "piechart",
        "title": "R√©partition par Navigateur",
        "id": 10,
        "datasource": "PostgreSQL",
        "targets": [
          { "rawSql": "SELECT browser, COUNT(*) as total FROM test_results GROUP BY browser", "refId": "A" }
        ]
      },

      {
        "type": "row",
        "title": "üöÄ Stats CI/CD (Jenkins Builds)",
        "id": 600
      },
      {
        "type": "graph",
        "title": "Tests Success/Fail par Build",
        "id": 11,
        "datasource": "PostgreSQL",
        "targets": [
          {
            "rawSql": "SELECT build_number as metric, SUM(CASE WHEN test_status='PASSED' THEN 1 ELSE 0 END) as passed, SUM(CASE WHEN test_status='FAILED' THEN 1 ELSE 0 END) as failed FROM test_results GROUP BY build_number ORDER BY build_number::int",
            "refId": "A"
          }
        ]
      }
    ],
    "templating": {
      "list": [
        {
          "name": "test_suite_name",
          "label": "Test Suite",
          "query": "SELECT DISTINCT test_suite_name FROM test_results ORDER BY 1",
          "datasource": "PostgreSQL",
          "refresh": 1,
          "type": "query"
        }
      ]
    }
  },
  "overwrite": true
}
